# Linode ç¾æ³æª¢æŸ¥å ±å‘Š
**æª¢æŸ¥æ™‚é–“**: 2026-01-19 18:22 (UTC+8)  
**Server IP**: 172.235.200.10  
**Domain**: noricare.app

---

## âœ… ç³»çµ±ç‹€æ…‹ç¸½è¦½

### ğŸ–¥ï¸ ç³»çµ±è³‡è¨Š
- **OS**: Ubuntu 6.8.0-71-generic (x86_64)
- **é‹è¡Œæ™‚é–“**: 3 å°æ™‚ 40 åˆ†é˜
- **è² è¼‰**: 0.16, 0.04, 0.01 (ä½è² è¼‰ï¼Œæ­£å¸¸)
- **ä½¿ç”¨è€…**: 1 å€‹æ´»èºé€£ç·š

### ğŸ’¾ è³‡æºä½¿ç”¨æƒ…æ³
| è³‡æº | ç¸½é‡ | å·²ç”¨ | å¯ç”¨ | ä½¿ç”¨ç‡ | ç‹€æ…‹ |
|------|------|------|------|--------|------|
| **ç£ç¢Ÿ** | 49G | 9.1G | 38G | 20% | âœ… å……è¶³ |
| **è¨˜æ†¶é«”** | 1.9Gi | 544Mi | 1.4Gi | 28% | âœ… æ­£å¸¸ |
| **Swap** | 495Mi | 32Mi | 463Mi | 6% | âœ… æ­£å¸¸ |

---

## ğŸ³ Docker æœå‹™ç‹€æ…‹

### Docker ç‰ˆæœ¬
- **Docker**: v29.1.5
- **Docker Compose**: v5.0.1

### é‹è¡Œä¸­çš„æœå‹™
| æœå‹™åç¨± | æ˜ åƒæª” | ç‹€æ…‹ | é‹è¡Œæ™‚é–“ | åŸ å£ |
|----------|--------|------|----------|------|
| **deploy-api-1** | deploy-api | âœ… Up | 3 hours | 8000/tcp |
| **deploy-caddy-1** | caddy:2 | âœ… Up | 2 hours | 80, 443 (HTTP/HTTPS) |
| **deploy-db-1** | postgres:16-alpine | âœ… Up | 3 hours | 5432/tcp |

**çµè«–**: æ‰€æœ‰é—œéµæœå‹™æ­£å¸¸é‹è¡Œ âœ…

---

## âš™ï¸ ç’°å¢ƒè®Šæ•¸é…ç½®

### âœ… å·²æ­£ç¢ºè¨­å®š
- `APP_DOMAIN=noricare.app`
- `ACME_EMAIL=steve_chen@premierbiz.com.tw`
- `GEMINI_API_KEY=AIza...920` (æœ‰æ•ˆ)
- `GEMINI_MODEL_NAME=gemini-3-flash-preview`
- `JWT_SECRET_KEY=Doui...LLA` (64+ å­—å…ƒ)
- `ACCESS_TOKEN_EXPIRE_MINUTES=43200` (30å¤©)
- `POSTGRES_DB=personalhealth`
- `POSTGRES_USER=personalhealth`
- `POSTGRES_PASSWORD=AX6j...D5c` (å¼·å¯†ç¢¼)
- `PROJECT_NAME=NoriCare`

### âš ï¸ **é—œéµå•é¡Œç™¼ç¾**
```diff
- BACKEND_CORS_ORIGINS=<ç¼ºå¤±>
```

**å½±éŸ¿**: 
- å‰ç«¯ç„¡æ³•å‘¼å« API (CORS blocked)
- ç€è¦½å™¨æœƒé¡¯ç¤ºè·¨åŸŸéŒ¯èª¤
- æ‰€æœ‰ API è«‹æ±‚éƒ½æœƒå¤±æ•—

**å¿…é ˆä¿®å¾©**: éœ€è¦æ·»åŠ  `BACKEND_CORS_ORIGINS=https://noricare.app`

---

## ğŸ—„ï¸ è³‡æ–™åº«ç‹€æ…‹

### PostgreSQL è³‡è¨Š
- **ç‰ˆæœ¬**: PostgreSQL 16.11
- **å¹³å°**: x86_64-pc-linux-musl
- **ç·¨è­¯å™¨**: GCC 15.2.0
- **é€£ç·š**: âœ… æ­£å¸¸

### è³‡æ–™åº«æ¸¬è©¦çµæœ
```
âœ… é€£ç·šæˆåŠŸ
âœ… ç‰ˆæœ¬æŸ¥è©¢æ­£å¸¸
âœ… å®¹å™¨å¥åº·
```

---

## ğŸ“± å‰ç«¯ (Flutter Web)

### Build æª”æ¡ˆç‹€æ…‹
```
âœ… index.html (3.7K) - å­˜åœ¨
âœ… main.dart.js (2.7M) - å­˜åœ¨
âœ… flutter.js (7.7K) - å­˜åœ¨
âœ… flutter_bootstrap.js (8.0K) - å­˜åœ¨
âœ… assets/ - ç›®éŒ„å­˜åœ¨
âœ… canvaskit/ - ç›®éŒ„å­˜åœ¨
âœ… icons/ - ç›®éŒ„å­˜åœ¨
```

**ç·¨è­¯æ™‚é–“**: 2024-01-18 16:03  
**çµè«–**: Flutter Web build å®Œæ•´ä¸”æ­£å¸¸ âœ…

---

## ğŸ”§ API æœå‹™åˆ†æ

### API Logs åˆ†æ (æœ€è¿‘ 30 è¡Œ)
**æ´»èºç«¯é»**:
- âœ… `POST /api/v1/users/` - ä½¿ç”¨è€…å»ºç«‹
- âœ… `POST /api/v1/ocr/upload` - OCR ä¸Šå‚³
- âœ… `GET /api/v1/ocr/result/{id}` - OCR çµæœæŸ¥è©¢
- âœ… `POST /api/v1/recommendation/generate` - AI å ±å‘Šç”Ÿæˆ (19.99s)
- âœ… `GET /api/v1/users/{id}/history` - æ­·å²è¨˜éŒ„
- âœ… `POST /api/v1/chat/message` - èŠå¤©åŠŸèƒ½

**AI ç”Ÿæˆæ•ˆèƒ½**:
- Supplement advice: 14.11s
- Food advice: 14.94s
- Meal plan: 19.99s
- **ç¸½è€—æ™‚**: 19.99s (å¹³è¡Œè™•ç†)

### âš ï¸ **è­¦å‘Šè¨Šæ¯**
```
âŒ è¼‰å…¥ç‡Ÿé¤Šè³‡æ–™åº«å¤±æ•—: [Errno 2] No such file or directory: 
   'é£Ÿå“ç‡Ÿé¤Šæˆåˆ†è³‡æ–™åº«2024UPDATE2_clean.csv'
```

**å½±éŸ¿**: 
- ç‡Ÿé¤Šæˆåˆ†æœå°‹åŠŸèƒ½ç„¡æ³•ä½¿ç”¨
- `/api/v1/nutrition/search` å¯èƒ½è¿”å›ç©ºçµæœ

**éœ€è¦ä¿®å¾©**: ä¸Šå‚³ç‡Ÿé¤Šè³‡æ–™åº« CSV æª”æ¡ˆ

---

## ğŸš¨ ç™¼ç¾çš„å•é¡Œç¸½çµ

| å„ªå…ˆç´š | å•é¡Œæè¿° | å½±éŸ¿ | å»ºè­°ä¿®å¾© |
|--------|----------|------|----------|
| ğŸ”´ **P0** | `BACKEND_CORS_ORIGINS` ç¼ºå¤± | å‰ç«¯ç„¡æ³•å‘¼å« API | **ç«‹å³ä¿®å¾©** |
| ğŸŸ¡ **P1** | ç‡Ÿé¤Šè³‡æ–™åº«æª”æ¡ˆç¼ºå¤± | ç‡Ÿé¤Šæœå°‹åŠŸèƒ½å¤±æ•ˆ | ä¸Šå‚³ CSV æª”æ¡ˆ |
| ğŸŸ¢ **P2** | é Git å„²å­˜åº« | ç„¡ç‰ˆæœ¬æ§åˆ¶ | åˆå§‹åŒ– Git (å¯é¸) |

---

## ğŸ“‹ å»ºè­°ä¿®å¾©æ­¥é©Ÿ

### 1ï¸âƒ£ ä¿®å¾© CORS (æœ€å„ªå…ˆ)

```bash
# SSH åˆ° Linode
ssh root@172.235.200.10

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸
cd /root/personalhealth/deploy
nano .env.linode

# æ·»åŠ ä»¥ä¸‹è¡Œ:
BACKEND_CORS_ORIGINS=https://noricare.app

# é‡å•Ÿ API æœå‹™
docker compose --env-file .env.linode -f docker-compose.linode.yml restart api

# é©—è­‰
curl -I -H "Origin: https://noricare.app" https://noricare.app/health
# æ‡‰è©²çœ‹åˆ°: Access-Control-Allow-Origin: https://noricare.app
```

### 2ï¸âƒ£ ä¸Šå‚³ç‡Ÿé¤Šè³‡æ–™åº«

```powershell
# åœ¨æœ¬æ©ŸåŸ·è¡Œ
scp C:\Users\User\Desktop\personalhealth\é£Ÿå“ç‡Ÿé¤Šæˆåˆ†è³‡æ–™åº«2024UPDATE2_clean.csv root@172.235.200.10:/root/personalhealth/

# é‡å•Ÿ API ä½¿å…¶è¼‰å…¥
ssh root@172.235.200.10 "cd /root/personalhealth/deploy && docker compose --env-file .env.linode -f docker-compose.linode.yml restart api"
```

### 3ï¸âƒ£ é©—è­‰ä¿®å¾©

```bash
# æ¸¬è©¦ CORS
curl -I -H "Origin: https://noricare.app" https://noricare.app/health

# æ¸¬è©¦ç‡Ÿé¤Šæœå°‹ (éœ€è¦ JWT token)
curl https://noricare.app/api/v1/nutrition/search?query=é›èƒ¸è‚‰ \
  -H "Authorization: Bearer {token}"
```

---

## ğŸ¯ æº–å‚™éƒ¨ç½²æ–°ç‰ˆæœ¬

### ç•¶å‰ç‹€æ…‹è©•ä¼°
| æª¢æŸ¥é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| Docker æœå‹™é‹è¡Œ | âœ… | æ‰€æœ‰æœå‹™æ­£å¸¸ |
| ç£ç¢Ÿç©ºé–“ | âœ… | 38G å¯ç”¨ (å……è¶³) |
| è¨˜æ†¶é«” | âœ… | 1.4Gi å¯ç”¨ (æ­£å¸¸) |
| Flutter Build | âœ… | æª”æ¡ˆå®Œæ•´ |
| è³‡æ–™åº«é€£ç·š | âœ… | PostgreSQL æ­£å¸¸ |
| **CORS è¨­å®š** | âŒ | **éœ€ä¿®å¾©** |
| **ç‡Ÿé¤Šè³‡æ–™åº«** | âŒ | **éœ€ä¸Šå‚³** |

### å»ºè­°éƒ¨ç½²æµç¨‹

**é¸é … A: å…ˆä¿®å¾©ç¾æœ‰å•é¡Œï¼Œå†éƒ¨ç½²æ–°ç‰ˆæœ¬**
```
1. ä¿®å¾© CORS (5 åˆ†é˜)
2. ä¸Šå‚³ç‡Ÿé¤Šè³‡æ–™åº« (2 åˆ†é˜)
3. é©—è­‰ä¿®å¾© (5 åˆ†é˜)
4. éƒ¨ç½²æ–°ç‰ˆæœ¬ (10 åˆ†é˜)
ç¸½è¨ˆ: ç´„ 22 åˆ†é˜
```

**é¸é … B: ç›´æ¥éƒ¨ç½²æ–°ç‰ˆæœ¬ (åŒ…å«ä¿®å¾©)**
```
1. åœ¨æœ¬æ©Ÿæ›´æ–° .env.linode.example (æ·»åŠ  CORS)
2. åŸ·è¡Œè‡ªå‹•éƒ¨ç½²è…³æœ¬ (åŒ…å«æ‰€æœ‰æª”æ¡ˆ)
3. åœ¨ server ä¸Šæ‰‹å‹•ç·¨è¼¯ .env.linode
4. é‡å•Ÿæœå‹™
ç¸½è¨ˆ: ç´„ 15 åˆ†é˜
```

**æ¨è–¦**: é¸é … B (æ›´å¿«ä¸”å®Œæ•´)

---

## ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™

### API å›æ‡‰æ™‚é–“ (å¾ logs è§€å¯Ÿ)
- OCR Upload: < 1s
- OCR Processing: è®Šå‹• (ä¾åœ–ç‰‡è¤‡é›œåº¦)
- AI Report Generation: 20s (åˆç†)
- User CRUD: < 100ms
- Chat Message: < 500ms

### ç³»çµ±è² è¼‰
- CPU: ä½ (0.16 å¹³å‡)
- Memory: 28% (æ­£å¸¸)
- Disk I/O: æ­£å¸¸
- Network: æ­£å¸¸

**çµè«–**: ç³»çµ±æ•ˆèƒ½è‰¯å¥½ï¼Œå¯æ‰¿å—æ›´å¤šæµé‡ âœ…

---

## ğŸ” å®‰å…¨æ€§æª¢æŸ¥

| é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| HTTPS | âœ… | Caddy è‡ªå‹•ç®¡ç† Let's Encrypt |
| JWT Secret | âœ… | 64+ å­—å…ƒå¼·éš¨æ©Ÿå­—ä¸² |
| DB Password | âœ… | å¼·å¯†ç¢¼ |
| CORS | âš ï¸ | ç¼ºå¤±ï¼Œéœ€æ·»åŠ  |
| Firewall | âš ï¸ | æœªæª¢æŸ¥ (éœ€ SSH é©—è­‰) |
| SSH Key | âš ï¸ | ä½¿ç”¨å¯†ç¢¼ç™»å…¥ (å»ºè­°æ”¹ç”¨ key) |

---

## ğŸ“ ç¸½çµ

### âœ… å„ªé»
1. æ‰€æœ‰ Docker æœå‹™ç©©å®šé‹è¡Œ 3+ å°æ™‚
2. è³‡æºä½¿ç”¨åˆç† (ç£ç¢Ÿ 20%ï¼Œè¨˜æ†¶é«” 28%)
3. Flutter Web build å®Œæ•´ä¸”æœ€æ–°
4. è³‡æ–™åº«é€£ç·šæ­£å¸¸
5. API åŠŸèƒ½å¤§éƒ¨åˆ†é‹ä½œæ­£å¸¸
6. AI ç”Ÿæˆæ•ˆèƒ½è‰¯å¥½ (20s)

### âš ï¸ éœ€ç«‹å³ä¿®å¾©
1. **BACKEND_CORS_ORIGINS ç¼ºå¤±** - å°è‡´å‰ç«¯ç„¡æ³•å‘¼å« API
2. **ç‡Ÿé¤Šè³‡æ–™åº«æª”æ¡ˆç¼ºå¤±** - ç‡Ÿé¤Šæœå°‹åŠŸèƒ½å¤±æ•ˆ

### ğŸ¯ å¯é€²è¡Œæ–°ç‰ˆæœ¬éƒ¨ç½²
**å‰ææ¢ä»¶**:
- å…ˆä¿®å¾©ä¸Šè¿° 2 å€‹å•é¡Œ
- æˆ–åœ¨æ–°ç‰ˆæœ¬éƒ¨ç½²æ™‚ä¸€ä½µä¿®å¾©

**é è¨ˆéƒ¨ç½²æ™‚é–“**: 10-15 åˆ†é˜  
**é è¨ˆé¢¨éšª**: ä½ (ç¾æœ‰æœå‹™ç©©å®š)

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°

### ç«‹å³åŸ·è¡Œ (5 åˆ†é˜å…§)
1. ä¿®å¾© CORS è¨­å®š
2. ä¸Šå‚³ç‡Ÿé¤Šè³‡æ–™åº«æª”æ¡ˆ
3. é‡å•Ÿ API æœå‹™
4. é©—è­‰ä¿®å¾©

### çŸ­æœŸ (æœ¬æ¬¡éƒ¨ç½²)
1. åŸ·è¡Œæ–°ç‰ˆæœ¬éƒ¨ç½²è…³æœ¬
2. åŒ…å«æœ¬æ¬¡ UI æ›´æ–°å’Œæ–° API
3. é©—è­‰æ‰€æœ‰æ–°åŠŸèƒ½

### ä¸­æœŸ (æœªä¾†å„ªåŒ–)
1. è¨­å®š SSH key èªè­‰
2. é…ç½®é˜²ç«ç‰†è¦å‰‡
3. è¨­å®šè‡ªå‹•å‚™ä»½
4. åŠ å…¥ç›£æ§å‘Šè­¦

---

**å ±å‘Šç”¢ç”Ÿæ™‚é–“**: 2026-01-19 18:30  
**æª¢æŸ¥è€…**: GitHub Copilot  
**ç‹€æ…‹**: ç³»çµ±å¥åº·ï¼Œéœ€ä¿®å¾© 2 å€‹å•é¡Œå¾Œå¯éƒ¨ç½²æ–°ç‰ˆæœ¬
